---
title: "means-map"
author: "Julien Brun"
knit: (function(input_file, encoding) {
  out_dir <- 'docs';
  rmarkdown::render(input_file,
 encoding=encoding,
 output_file=file.path(dirname(input_file), out_dir, 'means_maps.html'))})
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, warning=FALSE, message=FALSE}
library(tidyverse)
library(lubridate)
library(purrr)
library(sf)
library(tmap)
library(RColorBrewer)
```

## Reading the data

```{r paths}

# Define the paths and file names

path_aurora <- "/home/shares/ca-mpa/data/sync-data/"
shp_dir <- "spatial_data"
cencoos_dir <- "CeNCOOS_shapefiles/Ecological_Monitoring_Sites"
shp_path <- file.path(path_aurora, shp_dir)

shp_ca <- file.path(path_aurora, shp_dir, "ca_boundary_wgs84.shp")


input_file <- "Ecol_perform_metrics_means_working.xlsx" 

map_file <- "mpa-attributes.xlsx"


```


# Read the input files


```{r read inputs, message=FALSE, warning=FALSE}

st_perform_metrics_ci <- st_read(dsn = file.path(path_aurora, cencoos_dir, "sampling_sites_4regions.geojson"))

# map_attributes <-  readxl::read_excel(file.path(data_path, map_file), 
#                             sheet=1, na = c("NA", "."), trim_ws = T)

# Read California border
ca <- st_read(shp_ca)
st_crs(ca)


# st_perform_metrics <- perform_metrics %>% 
#   st_as_sf(.,coords=c("lon_wgs84", "lat_wgs84"), crs=4326)



```


```{r}
tm_reg4 <- tm_shape(ca) + 
  tm_borders("black", lwd = .5) +
tm_shape(st_perform_metrics_ci) + 
  tm_symbols(col = "mlpa_region",  alpha = 0.8, border.lwd = 0, size = .2, title.col = "Main Regions")

tm_reg4

```
## Compute the stats

